# $Header: /usr/local/arg/ccra2/online/wbs/src/main/resources/com/arg/cb2/inquiry/mea/oi-statement.properties,v 1.1 2009/02/19 12:28:31 chalermp Exp $
#
# Copyright Notice:
# Copyright 2003 Advanced Research Group Co., Ltd.
# All rights reserved.  ARG PROPRIETARY/CONFIDENTIAL.
# Use is subject to license terms.

#AlertMessagesBiz.getAlertMessages=SELECT (SELECT groupaiid FROM spm_user WHERE uid = a.uid) AS groupid, 0 AS login_alert_type,CAST(total_new_message AS VARCHAR) AS login_alert_record, null AS period, 0 as read_flag FROM view_new_message a WHERE a.uid = {UID} UNION SELECT groupid, login_alert_type, login_alert_record, period, read_flag FROM prod_login_alert WHERE groupid = {GROUPID}
#AlertMessagesBiz.getAlertMessages=select ( select groupaiid from spm_user where uid = a.uid) as groupid , 0 as login_alert_type , cast(total_new_message as varchar) as login_alert_record , null as period , 0 as read_flag from view_new_message a where a.uid = {UID} union select groupid, login_alert_type , login_alert_record ,period,read_flag from prod_login_alert where groupid = {GROUPID} union all SELECT GROUPID ,12 as login_alert_type ,COUNT(MONITORID) AS login_alert_record ,NULL AS period ,0 AS read_flag FROM PROD_REGISTER WHERE (PRODUCT_TYPE = 56) AND DISABLED_FLAG <> 1 AND AUTO_RENEW = 0 AND DATEDIFF(DD,DATE_STOP,getdate()) >= 0 AND DATEDIFF(DD,DATE_STOP,getdate()) <= 30 AND UID = {UID} GROUP BY GROUPID union all SELECT trans.groupid ,13 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag FROM TRAN_DETAIL_OMS_ACCESS as trans where status_id in (2,11,12,14,16,27) and trans.userid = {UID} group by groupid union all SELECT a.groupid ,14 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag from ( SELECT TRANS.GROUPID FROM TRAN_DETAIL_OMS_ACCESS AS TRANS (nolock) WHERE TRANS.STATUS_ID = 2 AND TRANS.MODULEID = 1 AND TRANS.USERID = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (184)),0) union all SELECT TRANS.GROUPID FROM TRAN_DETAIL_OMS_ACCESS AS TRANS (nolock) WHERE TRANS.STATUS_ID = 16 AND TRANS.MODULEID = 2 AND TRANS.USERID = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (185)),0) union all SELECT TRANS.GROUPID FROM TRAN_DETAIL_OMS_ACCESS AS TRANS (nolock) WHERE TRANS.STATUS_ID = 27 AND TRANS.MODULEID = 3 AND TRANS.USERID =ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (186)),0) union all SELECT TRANS.GROUPID FROM TRAN_DETAIL_OMS_ACCESS AS TRANS (nolock) WHERE TRANS.STATUS_ID = 35 AND TRANS.MODULEID = 4 AND TRANS.USERID = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (187)),0)) a group by a.groupid
#AlertMessagesBiz.getAlertMessages=select ( select groupaiid from spm_user where uid = a.uid) as groupid , 0 as login_alert_type , cast(total_new_message as varchar) as login_alert_record , null as period , 0 as read_flag from view_new_message a where a.uid = {UID} union select groupid, login_alert_type , login_alert_record ,period,read_flag from prod_login_alert where groupid = {GROUPID} union all SELECT GROUPID ,12 as login_alert_type ,COUNT(MONITORID) AS login_alert_record ,NULL AS period ,0 AS read_flag FROM PROD_REGISTER WHERE (PRODUCT_TYPE = 56) AND DISABLED_FLAG <> 1 AND AUTO_RENEW = 0 AND DATEDIFF(DD,DATE_STOP,getdate()) >= 0 AND DATEDIFF(DD,DATE_STOP,getdate()) <= 30 AND uid = {UID} GROUP BY GROUPID union all SELECT DET.groupid ,13 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag FROM OMS_DETAIL_ACCESS as DET (nolock) , base_oms_status as bas (nolock) where DET.status_id = bas.status_id and bas.outstanding_flag = 1 and DET.createdby = {UID} group by groupid union all SELECT a.groupid ,14 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag from ( SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 2 AND DET.MODULEID = 1 AND DET.UPDATEDBY = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (184)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 13 AND DET.MODULEID = 2 AND DET.UPDATEDBY = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (185)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 20 AND DET.MODULEID = 3 AND DET.UPDATEDBY =ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (186)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 25 AND DET.MODULEID = 4 AND DET.UPDATEDBY = ISNULL((select uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (187)),0)) a group by a.groupid
#AlertMessagesBiz.getAlertMessages=select ( select groupaiid from spm_user where uid = a.uid) as groupid , 0 as login_alert_type , cast(total_new_message as varchar) as login_alert_record , null as period , 0 as read_flag from view_new_message a where a.uid = {UID} union select groupid, login_alert_type , login_alert_record ,period,read_flag from prod_login_alert where groupid = {GROUPID} union all SELECT GROUPID ,12 as login_alert_type ,COUNT(MONITORID) AS login_alert_record ,NULL AS period ,0 AS read_flag FROM PROD_REGISTER WHERE (PRODUCT_TYPE = 56) AND DISABLED_FLAG <> 1 AND AUTO_RENEW = 0 AND DATEDIFF(DD,DATE_STOP,getdate()) >= 0 AND DATEDIFF(DD,DATE_STOP,getdate()) <= 30 AND UID = {UID} GROUP BY GROUPID union all SELECT DET.groupid ,13 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag FROM OMS_DETAIL_ACCESS as DET (nolock) , base_oms_status as bas (nolock) where DET.status_id = bas.status_id and bas.outstanding_flag = 1 and DET.createdby = {UID} group by groupid union all -- AWAITING APPROVAL IN OMS -- SELECT a.groupid ,14 as login_alert_type ,COUNT(1) as login_alert_record ,NULL AS period ,0 AS read_flag from ( SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 2 AND DET.MODULEID = 1 AND DET.UPDATEDBY = ISNULL((select top 1 uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (184)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 13 AND DET.MODULEID = 2 AND DET.UPDATEDBY = ISNULL((select top 1 uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (185)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 20 AND DET.MODULEID = 3 AND DET.UPDATEDBY =ISNULL((select top 1 uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (186)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.STATUS_ID = 25 AND DET.MODULEID = 4 AND DET.UPDATEDBY = ISNULL((select top 1 uid from spm_privilegeuser as pr (nolock) where pr.uid = {UID} and pr.objectid in (187)),0)) a group by a.groupid
AlertMessagesBiz.getAlertMessages=select ( select groupaiid from spm_user (nolock) where uid = a.uid) as groupid , 0 as login_alert_type , cast(total_new_message as varchar) as login_alert_record , null as period , 0 as read_flag from view_new_message a where a.uid = {UID} union select groupid, login_alert_type , login_alert_record ,period,read_flag from prod_login_alert (nolock) where groupid = {GROUPID} union all SELECT GROUPID ,12 as login_alert_type ,cast(COUNT(MONITORID)as varchar) AS login_alert_record ,NULL AS period ,0 AS read_flag FROM PROD_REGISTER (nolock) WHERE (PRODUCT_TYPE = 56) AND DISABLED_FLAG <> 1 AND AUTO_RENEW = 0 AND DATEDIFF(DD,DATE_STOP,getdate()) >= 0 AND DATEDIFF(DD,DATE_STOP,getdate()) <= 30 AND uid = {UID} GROUP BY GROUPID union all SELECT DET.groupid ,13 as login_alert_type ,cast(COUNT(1) as varchar) as login_alert_record ,NULL AS period ,0 AS read_flag FROM OMS_DETAIL_ACCESS as DET (nolock) where (DET.process_status = 'A01' or DET.process_status = 'A02' or DET.process_status = 'A07') and (DET.updatedby = {UID} or DET.createdby = {UID}) group by groupid union all SELECT a.groupid ,14 as login_alert_type ,cast(COUNT(1)as varchar) as login_alert_record ,NULL AS period ,0 AS read_flag from ( SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.PROCESS_STATUS = 'A02' AND DET.MODULEID = 1 AND DET.OWNER_GROUP = ISNULL((select groupaiid from spm_privilegeuser as pr (nolock) , spm_user as ur (nolock) where pr.uid = ur.uid and pr.uid = {UID} and pr.objectid in (184)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.PROCESS_STATUS = 'A02' AND DET.MODULEID = 2 AND DET.OWNER_GROUP = ISNULL((select groupaiid from spm_privilegeuser as pr (nolock) , spm_user as ur (nolock) where pr.uid = ur.uid and pr.uid = {UID} and pr.objectid in (185)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.PROCESS_STATUS = 'A02' AND DET.MODULEID = 3 AND DET.OWNER_GROUP = ISNULL((select groupaiid from spm_privilegeuser as pr (nolock) , spm_user as ur (nolock) where pr.uid = ur.uid and pr.uid = {UID} and pr.objectid in (186)),0) union all SELECT DET.GROUPID FROM OMS_DETAIL_ACCESS AS DET (nolock) WHERE DET.PROCESS_STATUS = 'A02' AND DET.MODULEID = 4 AND DET.OWNER_GROUP = ISNULL((select groupaiid from spm_privilegeuser as pr (nolock) , spm_user as ur (nolock) where pr.uid = ur.uid and pr.uid = {UID} and pr.objectid in (187)),0)) a group by a.groupid

#AlertLogicManager.java
AlertLogicManager.update.readflag=update prod_login_alert set read_flag =1, updatedby = {0}, updateddate = getdate() where groupid = {1} and login_alert_type = {2}
AlertLogicManager.update.productUsage=UPDATE spm_expense SET productusage = {0}, cbuid = {2} WHERE expenseid={1}
AlertLogicManager.update.companyNameExpense=UPDATE mal_productdeliver SET companyname = '{0}', expenseid = {2} WHERE transactionid ={1}
AlertLogicManager.update.MonitoringExpense=UPDATE spm_expense SET disabled = 0 WHERE expenseid = {0}
AlertLogicManager.update.companyName=UPDATE mal_productdeliver SET companyname = '{0}' WHERE transactionid ={1}
AlertLogicManager.update.amoutResult=UPDATE spm_transaction SET amountresult = {0} WHERE transactionid = {1}

#AlertQuery.java
AlertQuery.select.enquiryalertSubscribe=SELECT MONITORID, TRANSACTIONID, EXPENSEID, UID, GROUPAIID, GROUPID, PRODUCT_TYPE, CBUID, DATE_START, DATE_STOP, LAST_DATE_DELIVER, REASONCODE, HKBRC, HKCI, OTHER_REG_NO, PLACE_OF_REG, COMPANY_NAME_EN, COMPANY_NAME_LO, AIREFCODE1, AIREFCODE2, AIREFCODE3, AUTO_RENEW, DISABLED_FLAG, TOTAL_PRODUCT_DELIVER, CURRENT_ACCUM, WAIT_DISABLED_FLAG, WAIT_DISABLED_DATE,  DISABLED_DATE, UPDATEDDATE FROM PROD_REGISTER (nolock) WHERE PRODUCT_TYPE = 56 AND UID = {0} AND DISABLED_FLAG = 0 AND (WAIT_DISABLED_FLAG = 0 OR WAIT_DISABLED_FLAG IS NULL)
AlertQuery.select.enquiryalertUnsubscribe=SELECT MONITORID, TRANSACTIONID, EXPENSEID, UID, GROUPAIID, GROUPID, PRODUCT_TYPE, CBUID, DATE_START, DATE_STOP, LAST_DATE_DELIVER, REASONCODE, HKBRC, HKCI, OTHER_REG_NO, PLACE_OF_REG, COMPANY_NAME_EN, COMPANY_NAME_LO, AIREFCODE1, AIREFCODE2, AIREFCODE3, AUTO_RENEW, DISABLED_FLAG, TOTAL_PRODUCT_DELIVER, CURRENT_ACCUM, WAIT_DISABLED_FLAG, WAIT_DISABLED_DATE,  DISABLED_DATE, UPDATEDDATE FROM PROD_REGISTER (nolock) WHERE PRODUCT_TYPE = 56 AND UID = {0} AND (DISABLED_FLAG = 1 OR WAIT_DISABLED_FLAG = 1)  AND DATE_STOP >= dateadd(year, -1, getdate())
AlertQuery.select.monitoringalertSubscribe=SELECT MONITORID, TRANSACTIONID, EXPENSEID, UID, GROUPAIID, GROUPID, PRODUCT_TYPE, CBUID, DATE_START, DATE_STOP, LAST_DATE_DELIVER, REASONCODE, HKBRC, HKCI, OTHER_REG_NO, PLACE_OF_REG, COMPANY_NAME_EN, COMPANY_NAME_LO, AIREFCODE1, AIREFCODE2, AIREFCODE3, AUTO_RENEW, DISABLED_FLAG, TOTAL_PRODUCT_DELIVER, CURRENT_ACCUM, WAIT_DISABLED_FLAG, WAIT_DISABLED_DATE,  DISABLED_DATE, UPDATEDDATE FROM PROD_REGISTER (nolock) WHERE PRODUCT_TYPE = 54 AND UID = {0} AND DISABLED_FLAG = 0 AND AUTO_RENEW = 1
AlertQuery.select.monitoringalertUnsubscribe=SELECT MONITORID, TRANSACTIONID, EXPENSEID, UID, GROUPAIID, GROUPID, PRODUCT_TYPE, CBUID, DATE_START, DATE_STOP, LAST_DATE_DELIVER, REASONCODE, HKBRC, HKCI, OTHER_REG_NO, PLACE_OF_REG, COMPANY_NAME_EN, COMPANY_NAME_LO, AIREFCODE1, AIREFCODE2, AIREFCODE3, AUTO_RENEW, DISABLED_FLAG, TOTAL_PRODUCT_DELIVER, CURRENT_ACCUM, WAIT_DISABLED_FLAG, WAIT_DISABLED_DATE,  DISABLED_DATE, UPDATEDDATE FROM PROD_REGISTER (nolock) WHERE PRODUCT_TYPE = 54 AND UID = {0} AND (DISABLED_FLAG = 1 OR AUTO_RENEW = 0) AND DATE_STOP >= dateadd(year, -1, getdate())

#Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3, trans.alert_date AS report_issued_date, base_reason.description_en AS reasoncode, regis.uid, trans.preferredlanguage, (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name, spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid, spm_user.email, regis.date_start, regis.date_stop, regis.product_type FROM prod_register AS regis, base_reason, prod_alert_trans AS trans, spm_user WHERE regis.reasoncode = base_reason.id AND regis.monitorid = trans.monitorid AND regis.uid = spm_user.uid AND trans.alertid = ?
#Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3, trans.alert_date AS report_issued_date, CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS reasoncode, regis.uid, trans.preferredlanguage, (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name, spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid, spm_user.email, regis.date_start, regis.date_stop, regis.product_type FROM prod_register AS regis, base_reason, prod_alert_trans AS trans, spm_user WHERE regis.reasoncode = base_reason.id AND regis.monitorid = trans.monitorid AND regis.uid = spm_user.uid AND trans.alertid = ?
#Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3, trans.alert_date AS report_issued_date, CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS reasoncode, regis.uid, trans.preferredlanguage, (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name, spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid, spm_user.email, regis.date_start, regis.date_stop, regis.product_type , trans.expenseid FROM prod_register AS regis, base_reason, prod_alert_trans AS trans, spm_user WHERE regis.reasoncode = base_reason.id AND regis.monitorid = trans.monitorid AND regis.uid = spm_user.uid AND trans.alertid = ?
#Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3, trans.alert_date AS report_issued_date, CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS reasoncode, regis.uid, trans.preferredlanguage, (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name, spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid, spm_user.email, regis.date_start, regis.date_stop, regis.product_type , trans.expenseid ,trans.version FROM prod_register AS regis, base_reason, prod_alert_trans AS trans, spm_user WHERE regis.reasoncode = base_reason.id AND regis.monitorid = trans.monitorid AND regis.uid = spm_user.uid AND trans.alertid = ?
#Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3, trans.alert_date AS report_issued_date, CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS reasoncode, regis.uid, trans.preferredlanguage, (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name, spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid, spm_user.email, regis.date_start, regis.date_stop, regis.product_type , trans.expenseid , trans.version ,spm_expense.report_ref_no FROM prod_register AS regis, base_reason, prod_alert_trans AS trans, spm_user ,spm_expense WHERE regis.reasoncode = base_reason.id AND regis.monitorid = trans.monitorid AND regis.uid = spm_user.uid and trans.expenseid = spm_expense.expenseid AND trans.alertid = ?
Report.Header-and-CustomerProfile=SELECT trans.alertid, regis.airefcode1, regis.airefcode2, regis.airefcode3 , trans.alert_date AS report_issued_date , CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS reasoncode , regis.uid, trans.preferredlanguage , (select spm_group.group_name_en from spm_group where spm_group.groupid = spm_user.groupaiid) AS customer_name , spm_user.user_name_en AS prepared_for, spm_user.userid AS subscriber_no, regis.monitorid , spm_user.email, regis.date_start, regis.date_stop, regis.product_type , trans.expenseid , trans.version ,spm_expense.report_ref_no FROM prod_register AS regis inner join base_reason on regis.reasoncode = base_reason.id inner join prod_alert_trans as trans on regis.monitorid = trans.monitorid inner join spm_user on regis.uid = spm_user.uid left outer join spm_expense (nolock) on trans.expenseid = spm_expense.expenseid where trans.alertid = ?

Report.Blank-Profile=SELECT trans.HKBRC, trans.HKCI, trans.OTHER_REG_NO, trans.PLACE_OF_REG, trans.COMPANY_NAME_EN, trans.COMPANY_NAME_LO, trans.EXPENSEID FROM PROD_ALERT_TRANS as trans (nolock) where trans.alertid = ?

Report.Profile=SELECT group_name_en AS submitted_by, period AS member_report_date, hkbrc, hkci, other_reg_no, place_of_reg, company_name_en, company_name_lo, trade_name_en, trade_name_lo, previous_name_en, previous_name_lo, address_1+' '+isnull(address_2,'')+' '+isnull(address_3,'') AS address, address_lo_1+' '+isnull(address_lo_2,'')+' '+isnull(address_lo_3,'') AS address_lo, phone_no FROM prod_profile_object WHERE alertid = ? ORDER BY alert_seq

Report.RevocationOfConsent=SELECT group_name_en, notice_received_date, effective_date FROM prod_revocation_object WHERE alertid = ? ORDER BY alert_seq

#Report.EnquiryAlert=SELECT object.enquiry_date, base_reason.description_en AS enquiry_reason FROM prod_enquiry_object AS object, base_reason WHERE object.reasoncode = base_reason.id AND object.alertid = ? ORDER BY object.alert_seq
Report.EnquiryAlert=SELECT object.enquiry_date, CASE WHEN trans.preferredlanguage = 'L' THEN base_reason.description_lo ELSE base_reason.description_en END AS enquiry_reason FROM prod_enquiry_object AS object, base_reason, prod_alert_trans AS trans WHERE object.reasoncode = base_reason.id AND object.alertid = trans.alertid AND object.alertid = ? ORDER BY object.alert_seq

#Report.EnquiryHistory=SELECT base_reason.description_en AS enquiry_type, ISNULL(object.last1,0) AS last3months, ISNULL(object.last2,0) AS last12months, ISNULL(object.last3,0) AS last24months FROM base_reason LEFT OUTER JOIN prod_enquiry_history_object AS object ON base_reason.id = object.reasoncode AND object.alertid = ? WHERE base_reason.type = 'I' ORDER BY CASE WHEN base_reason.id = 2 THEN 3 WHEN base_reason.id = 3 THEN 2 ELSE base_reason.id END
Report.EnquiryHistory=exec arg_get_enquiry_history @alertid = ?

#Report.MonitoringPriod=SELECT alert_type, period FROM prod_monitoring_object WHERE alertid = ? GROUP BY alert_type, period ORDER BY alert_type ASC, CASE WHEN LEN(period) = 6 THEN period ELSE CONVERT(VARCHAR, CONVERT(DATETIME, period), 102) END DESC
#Report.MonitoringPriod=select aa.alert_type,aa.period,aa.loan_type from ( select mon.alertid,mon.alert_type,mon.period ,(case when isnull(convert(char(6),spm_group.launchccraii,112),0) < 200701 then 'Aggregate' else case when pr.a = 1 then 'REVOLVING' else case when pr.b = 2 then 'NON-REVOLVING' else case when pr.c = 3 then 'CONTINGENT/STANDBY' else case when pr.d = 4 then 'HP/LEASING' end end end end end) as loan_type ,pr.a,pr.b,pr.c,pr.d from prod_monitoring_object as mon,prod_alert_trans as al,prod_register as reg,spm_group ,( select cr.cbuid,cr.groupid,cr.period,(case when isnull(cr.amount_due_60_days_revol_fac,0) <> 0 then 1 else 99 end) as a, 0 as b, 0 as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_revol_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, (case when isnull(cr.amount_due_60_days_non_revol_fac,0) <> 0 then 2 else 99 end) as b, 0 as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_non_revol_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, 0 as b, (case when isnull(cr.amount_due_60_days_cont_fac,0) <> 0 then 3 else 99 end) as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_cont_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, 0 as b, 0 as c, (case when isnull(cr.amount_due_60_days_hp_fac,0) <> 0 then 4 else 99 end) as d from prod_credit as cr where cr.amount_due_60_days_hp_fac is not null ) as pr where mon.alertid = al.alertid and al.monitorid = reg.monitorid and reg.cbuid = pr.cbuid and reg.groupid = pr.groupid and reg.groupid = spm_group.groupid and mon.alertid = ? group by mon.alertid,mon.alert_type,spm_group.launchccraii,mon.period,pr.a,pr.b,pr.c,pr.d ) as aa group by aa.alertid,aa.alert_type,aa.period,aa.loan_type ORDER BY aa.alert_type ASC, CASE WHEN LEN(aa.period) = 6 THEN aa.period ELSE CONVERT(VARCHAR, CONVERT(DATETIME, aa.period), 102) END DESC
#Report.MonitoringPriod=SELECT alert_type, p.period , NULL as loan_type FROM prod_monitoring_object AS p (nolock) WHERE alertid = ? and alert_type in (1,2,4) GROUP BY p.alert_type, p.period UNION select aa.alert_type,aa.period,aa.loan_type from ( select mon.alertid,mon.alert_type,mon.period ,(case when isnull(convert(char(6),spm_group.launchccraii,112),0) < 200701 then 'Aggregate' else case when pr.a = 1 then 'REVOLVING' else case when pr.b = 2 then 'NON-REVOLVING' else case when pr.c = 3 then 'CONTINGENT/STANDBY' else case when pr.d = 4 then 'HP/LEASING' end end end end end) as loan_type ,pr.a,pr.b,pr.c,pr.d from prod_monitoring_object as mon,prod_alert_trans as al,prod_register as reg,spm_group ,( select cr.cbuid,cr.groupid,cr.period,(case when isnull(cr.amount_due_60_days_revol_fac,0) <> 0 then 1 else 99 end) as a,  0 as b,  0 as c,  0 as d  from prod_credit as cr  where cr.amount_due_60_days_revol_fac is not null  union all  select cr.cbuid,cr.groupid,cr.period,0 as a,  (case when isnull(cr.amount_due_60_days_non_revol_fac,0) <> 0 then 2 else 99 end) as b,  0 as c,  0 as d  from prod_credit as cr  where cr.amount_due_60_days_non_revol_fac is not null  union all  select cr.cbuid,cr.groupid,cr.period,0 as a,  0 as b,  (case when isnull(cr.amount_due_60_days_cont_fac,0) <> 0 then 3 else 99 end) as c,  0 as d  from prod_credit as cr  where cr.amount_due_60_days_cont_fac is not null  union all  select cr.cbuid,cr.groupid,cr.period,0 as a,  0 as b,  0 as c,  (case when isnull(cr.amount_due_60_days_hp_fac,0) <> 0 then 4 else 99 end) as d  from prod_credit as cr  where cr.amount_due_60_days_hp_fac is not null ) as pr where mon.alertid = al.alertid  and al.monitorid = reg.monitorid and reg.cbuid = pr.cbuid and reg.groupid = pr.groupid and reg.groupid = spm_group.groupid and mon.alert_type = 3 and mon.alertid = ? group by mon.alertid,mon.alert_type,spm_group.launchccraii,mon.period,pr.a,pr.b,pr.c,pr.d ) as aa group by aa.alertid,aa.alert_type,aa.period,aa.loan_type
#Report.MonitoringPriod=SELECT alert_type, p.period , NULL as loan_type FROM prod_monitoring_object AS p (nolock) WHERE alertid = ? and alert_type in (1,2,4) GROUP BY p.alert_type, p.period UNION select aa.alert_type,aa.period,aa.loan_type from ( select mon.alertid,mon.alert_type,mon.period ,(case when al.version = 1 then 'Aggregate' else case when pr.a = 1 then 'REVOLVING' else case when pr.b = 2 then 'NON-REVOLVING' else case when pr.c = 3 then 'CONTINGENT/STANDBY' else case when pr.d = 4 then 'HP/LEASING' end end end end end) as loan_type ,pr.a,pr.b,pr.c,pr.d from prod_monitoring_object as mon,prod_alert_trans as al,prod_register as reg,spm_group ,( select cr.cbuid,cr.groupid,cr.period,(case when isnull(cr.amount_due_60_days_revol_fac,0) <> 0 then 1 else 99 end) as a, 0 as b, 0 as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_revol_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, (case when isnull(cr.amount_due_60_days_non_revol_fac,0) <> 0 then 2 else 99 end) as b, 0 as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_non_revol_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, 0 as b, (case when isnull(cr.amount_due_60_days_cont_fac,0) <> 0 then 3 else 99 end) as c, 0 as d from prod_credit as cr where cr.amount_due_60_days_cont_fac is not null union all select cr.cbuid,cr.groupid,cr.period,0 as a, 0 as b, 0 as c, (case when isnull(cr.amount_due_60_days_hp_fac,0) <> 0 then 4 else 99 end) as d from prod_credit as cr where cr.amount_due_60_days_hp_fac is not null ) as pr where mon.alertid = al.alertid and al.monitorid = reg.monitorid and reg.cbuid = pr.cbuid and reg.groupid = pr.groupid and reg.groupid = spm_group.groupid and mon.alert_type = 3 and mon.alertid = ? group by mon.alertid,mon.alert_type,al.version,mon.period,pr.a,pr.b,pr.c,pr.d ) as aa group by aa.alertid,aa.alert_type,aa.period,aa.loan_type
Report.MonitoringPriod=SELECT a.alert_type,a.period , b.description_en as loan_type FROM prod_monitoring_object a (nolock),base_alert_type b (nolock) WHERE a.alert_type = b.id and a.alertid = ? GROUP BY a.alert_type,b.description_en ,a.period ORDER BY alert_type ASC , CASE WHEN LEN(period) = 6 THEN period ELSE CONVERT(VARCHAR, CONVERT(DATETIME, period), 102) END DESC
